---
title: "Geospatial exploratory data analysis"
execute:
  echo: false
  message: false
editor: visual
---

```{r}
#| include: false

library(osmdata)
library(sf)
library(sfnetworks)
library(dplyr)
library(ggplot2)
library(foot)
library(osmplotr)
library(patchwork)
source("R/centroid_bbox.R")
```

My story begins in Mumbai. Now, in 2022, it is a roaring megacity of almost 21 million people. While large, this number

The city bustles in some way every second of the day - rhythms rising, fading, cresting to a manic frenzy or just a staccato march. The beat of the place is bound to the people but the people too are constrained to their place. 20 million people squashed into an area just three quarters the area of New York city resulting in a crush of 20,000 people into one square kilometer. To put that into a realistic terms TODO - find one!

## Comparing Mumbai and London

```{r}
#| output: false

bbox <- get_centroid_bounding_box(
  c("lat" = 19.01879, "lng" = 72.85141),
  distance = 500,
  dist.unit = "m") %>% 
  get_bbox()

structs <- c ("highway", "building", "park", "landuse")
structures <- osm_structures (structures = structs, col_scheme = "dark")
structures$value [4] <- "recreation_ground"
structures$cols[4] <- "#647864FF"

parsi_colony <- make_osm_map (structures = structures, bbox = bbox)
p1 <- parsi_colony$map  + labs(title = "Parsi Colony, Dadar")
```

```{r}
#| output: false

bbox <- get_centroid_bounding_box(
  c("lat" = 19.07403, "lng" = 72.99571),
  distance = 500,
  dist.unit = "m") %>% 
  get_bbox()
structs <- c ("highway", "building", "park", "landuse", "leisure")
structures <- osm_structures (structures = structs, col_scheme = "dark")
structures$value [4] <- "recreation_ground"
structures$cols[4] <- "#647864FF"
structures$value [5] <- "sports_centre"
structures$cols[5] <- "#647864FF"

navi_mumbai_s2 <- make_osm_map (structures = structures, bbox = bbox)
p2 <- navi_mumbai_s2$map  + labs(title = "Sector 2, Vashi")
```

```{r}
#| output: false

bbox <- get_centroid_bounding_box(
  c("lat" = 51.51961, "lng" = -0.11370),
  distance = 500,
  dist.unit = "m") %>% 
  get_bbox()

structs <- c ("highway", "building", "park", "landuse", "leisure")
structures <- osm_structures (structures = structs, col_scheme = "dark")
structures$value [4] <- "recreation_ground"
structures$cols[4] <- "#647864FF"
structures$value [5] <- "garden"
structures$cols[5] <- "#647864FF"

holborn <- make_osm_map (structures = structures, bbox = bbox)
p3 <- holborn$map + labs(title = "Holborn, London")
```

```{r}
#| out.width="100%"
(p1 + theme(plot.margin = unit(c(0,5,0,0), "pt"))) + 
  (p2 + theme(plot.margin = unit(c(0,5,0,0), "pt"))) + 
  (p3) 
```

## Urban morphometrics

```{r}
all_dat <- bind_rows(dat$osm_data)
all_dat$polygon <- st_is(all_dat, "POLYGON") 
holborn_stats <- all_dat %>% select(-area) %>% 
  filter(polygon == TRUE) %>% 
  calculate_footstats(what = "all")
```
